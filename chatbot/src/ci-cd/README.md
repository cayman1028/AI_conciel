# CI/CDパイプライン設定

このプロジェクトは、継続的インテグレーション・継続的デプロイ（CI/CD）パイプラインを使用してコードの品質を維持し、自動デプロイを行います。

## パイプラインの概要

このCI/CDパイプラインは以下の要素で構成されています：

1. **継続的インテグレーション (CI)**
   - コードの品質チェック
   - 自動テスト実行
   - ビルドプロセスの検証

2. **継続的デプロイ (CD)**
   - 開発環境への自動デプロイ
   - 本番環境への手動承認デプロイ
   - デプロイ後の検証テスト

## GitHub Actionsワークフロー

### CIワークフロー (.github/workflows/ci.yml)

プルリクエストやブランチへのプッシュごとに実行される自動テストとビルド検証用のワークフローです。

- **トリガー**: Pull RequestやPush（main, developブランチ）
- **処理内容**:
  - リンター実行によるコードスタイル検証
  - ユニットテスト実行
  - ビルドプロセス検証

### CDワークフロー (.github/workflows/cd.yml)

マージや手動トリガーで実行されるデプロイ用ワークフローです。

- **トリガー**: mainブランチへのプッシュ、手動実行
- **処理内容**:
  - テスト実行
  - ビルド処理
  - 環境ごとのデプロイ（Vercel/Render）
  - デプロイ後の検証テスト

## Vercel連携

このプロジェクトはVercelと連携して自動デプロイを行います。

### 設定方法

1. Vercelダッシュボードにログインし、このリポジトリをインポート
2. フレームワークとして「Vite」を選択
3. 以下の設定を行う:
   - ルートディレクトリ: `chatbot`
   - ビルドコマンド: `npm run build`
   - 出力ディレクトリ: `dist`

### 環境変数

Vercelで以下の環境変数を設定します：

- `NODE_ENV`: デプロイ環境（production/development）

### GitHub Actionsからのデプロイ

GitHub Actionsから自動デプロイを行うために、以下のシークレットをリポジトリに設定します：

- `VERCEL_TOKEN`: Vercel APIトークン
- `VERCEL_ORG_ID`: Vercelの組織ID
- `VERCEL_PROJECT_ID`: Vercelのプロジェクトクトコード

## 手動デプロイ

ローカル環境から手動でデプロイする場合は、以下のコマンドを実行します：

```bash
# 開発環境へのデプロイ（テスト失敗を無視）
npm run deploy:dev:force

# Vercelへのデプロイ（テスト失敗を無視）
npm run deploy:vercel
```

## デプロイ後のテスト

デプロイ後に自動的に以下のテストが実行されます：

- サイトへのアクセス検証
- JavaScriptファイルの配信確認
- CORSヘッダーの設定確認

## トラブルシューティング

デプロイに問題がある場合は、以下を確認してください：

1. ビルドが正常に完了しているか
2. 環境変数が正しく設定されているか
3. デプロイログにエラーがないか

詳細なエラーはGitHub ActionsのワークフローログまたはVercelダッシュボードで確認できます。 